-- =============================================
--      AKB Coordinate UI - (Generated by Code)
-- =============================================

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Local Player & Character
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local NetworkEvent = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("NetworkFramework"):WaitForChild("NetworkEvent")

-- Clean up old UI if it exists
pcall(function()
    if PlayerGui:FindFirstChild("CoordinateUI") then
        PlayerGui.CoordinateUI:Destroy()
    end
end)

-- =============================================
--      UI Creation
-- =============================================
-- (ส่วนของการสร้าง UI ทั้งหมดเหมือนเดิม)
local ScreenGui = Instance.new("ScreenGui"); ScreenGui.Name = "CoordinateUI"; ScreenGui.ResetOnSpawn = false; ScreenGui.Parent = PlayerGui
local MainFrame = Instance.new("Frame"); MainFrame.Name = "MainFrame"; MainFrame.Size = UDim2.new(0, 250, 0, 280); MainFrame.Position = UDim2.new(0.5, -125, 0.5, -140); MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40); MainFrame.BorderSizePixel = 0; MainFrame.Active = true; MainFrame.Draggable = true; MainFrame.ClipsDescendants = true; MainFrame.Parent = ScreenGui
local UICorner_Main = Instance.new("UICorner", MainFrame); UICorner_Main.CornerRadius = UDim.new(0, 8)
local TitleBar = Instance.new("Frame"); TitleBar.Name = "TitleBar"; TitleBar.Size = UDim2.new(1, 0, 0, 30); TitleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 60); TitleBar.BorderSizePixel = 0; TitleBar.Parent = MainFrame
local UICorner_Title = Instance.new("UICorner", TitleBar); UICorner_Title.CornerRadius = UDim.new(0, 8)
local TitleLabel = Instance.new("TextLabel"); TitleLabel.Parent = TitleBar; TitleLabel.Name = "TitleLabel"; TitleLabel.Size = UDim2.new(1, -40, 1, 0); TitleLabel.Position = UDim2.new(0, 10, 0, 0); TitleLabel.BackgroundTransparency = 1; TitleLabel.Font = Enum.Font.SourceSansBold; TitleLabel.Text = "Player Coordinates"; TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255); TitleLabel.TextSize = 18; TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
local CollapseButton = Instance.new("TextButton"); CollapseButton.Parent = TitleBar; CollapseButton.Name = "CollapseButton"; CollapseButton.Size = UDim2.new(0, 20, 0, 20); CollapseButton.Position = UDim2.new(1, -25, 0.5, -10); CollapseButton.BackgroundColor3 = Color3.fromRGB(60, 60, 75); CollapseButton.Font = Enum.Font.SourceSansBold; CollapseButton.Text = "–"; CollapseButton.TextColor3 = Color3.fromRGB(255, 255, 255); CollapseButton.TextSize = 18
local UICorner_Collapse = Instance.new("UICorner", CollapseButton); UICorner_Collapse.CornerRadius = UDim.new(0, 4)
local CoordinateLabel = Instance.new("TextLabel"); CoordinateLabel.Parent = MainFrame; CoordinateLabel.Name = "CoordinateLabel"; CoordinateLabel.Size = UDim2.new(1, -20, 0, 30); CoordinateLabel.Position = UDim2.new(0, 10, 0, 40); CoordinateLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 65); CoordinateLabel.Font = Enum.Font.SourceSansBold; CoordinateLabel.Text = "X: 0.0, Y: 0.0, Z: 0.0"; CoordinateLabel.TextColor3 = Color3.fromRGB(200, 200, 200); CoordinateLabel.TextSize = 16
local UICorner_CoordLabel = Instance.new("UICorner", CoordinateLabel); UICorner_CoordLabel.CornerRadius = UDim.new(0, 6)
local InputBox = Instance.new("TextBox"); InputBox.Parent = MainFrame; InputBox.Name = "InputBox"; InputBox.Size = UDim2.new(1, -70, 0, 30); InputBox.Position = UDim2.new(0, 10, 0, 80); InputBox.BackgroundColor3 = Color3.fromRGB(50, 50, 65); InputBox.Font = Enum.Font.SourceSans; InputBox.Text = "X, Y, Z"; InputBox.TextColor3 = Color3.fromRGB(200, 200, 200); InputBox.TextSize = 16; InputBox.ClearTextOnFocus = true
local UICorner_InputBox = Instance.new("UICorner", InputBox); UICorner_InputBox.CornerRadius = UDim.new(0, 6)
local TeleportButton = Instance.new("TextButton"); TeleportButton.Parent = MainFrame; TeleportButton.Name = "TeleportButton"; TeleportButton.Size = UDim2.new(0, 50, 0, 30); TeleportButton.Position = UDim2.new(1, -60, 0, 80); TeleportButton.BackgroundColor3 = Color3.fromRGB(0, 150, 200); TeleportButton.Font = Enum.Font.SourceSansBold; TeleportButton.Text = "Go"; TeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255); TeleportButton.TextSize = 16
local UICorner_TeleportBtn = Instance.new("UICorner", TeleportButton); UICorner_TeleportBtn.CornerRadius = UDim.new(0, 6)
local FarmOreButton = Instance.new("TextButton"); FarmOreButton.Parent = MainFrame; FarmOreButton.Name = "FarmOreButton"; FarmOreButton.Size = UDim2.new(1, -20, 0, 30); FarmOreButton.Position = UDim2.new(0, 10, 0, 120); FarmOreButton.BackgroundColor3 = Color3.fromRGB(0, 170, 80); FarmOreButton.Font = Enum.Font.SourceSansBold; FarmOreButton.Text = "ฟามแร่"; FarmOreButton.TextColor3 = Color3.fromRGB(255, 255, 255); FarmOreButton.TextSize = 16
local UICorner_FarmOreBtn = Instance.new("UICorner", FarmOreButton); UICorner_FarmOreBtn.CornerRadius = UDim.new(0, 6)
local BuyFoodButton = Instance.new("TextButton"); BuyFoodButton.Name = "BuyFoodButton"; BuyFoodButton.Size = UDim2.new(1, -20, 0, 30); BuyFoodButton.Position = UDim2.new(0, 10, 0, 160); BuyFoodButton.BackgroundColor3 = Color3.fromRGB(255, 180, 0); BuyFoodButton.Font = Enum.Font.SourceSansBold; BuyFoodButton.Text = "ซื้ออาหาร"; BuyFoodButton.TextColor3 = Color3.fromRGB(255, 255, 255); BuyFoodButton.TextSize = 16; BuyFoodButton.Parent = MainFrame
local UICorner_BuyFoodBtn = Instance.new("UICorner", BuyFoodButton); UICorner_BuyFoodBtn.CornerRadius = UDim.new(0, 6)
local SellButton = Instance.new("TextButton"); SellButton.Name = "SellButton"; SellButton.Size = UDim2.new(1, -20, 0, 30); SellButton.Position = UDim2.new(0, 10, 0, 200); SellButton.BackgroundColor3 = Color3.fromRGB(150, 50, 200); SellButton.Font = Enum.Font.SourceSansBold; SellButton.Text = "ขายแร่"; SellButton.TextColor3 = Color3.fromRGB(255, 255, 255); SellButton.TextSize = 16; SellButton.Parent = MainFrame
local UICorner_SellBtn = Instance.new("UICorner", SellButton); UICorner_SellBtn.CornerRadius = UDim.new(0, 6)

-- =============================================
--      Logic & Functions
-- =============================================

-- State Variables
local isCollapsed = false
local originalSize = MainFrame.Size
local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

-- Farm Loop Variables
local isOreFarmLoopActive = false
local farmDestination = Vector3.new(-350, 24, -2358)
local autoProcessCoroutine = nil

-- Function: Update Coordinate Display
RunService.RenderStepped:Connect(function()
    if HumanoidRootPart and not isCollapsed then
        local pos = HumanoidRootPart.Position
        CoordinateLabel.Text = string.format("X: %.1f, Y: %.1f, Z: %.1f", pos.X, pos.Y, pos.Z)
    end
end)

-- Function: Toggle Collapse/Expand
local function toggleCollapse()
    isCollapsed = not isCollapsed
    local targetSize
    if isCollapsed then
        targetSize = UDim2.new(originalSize.X.Scale, originalSize.X.Offset, 0, TitleBar.AbsoluteSize.Y)
        CoordinateLabel.Visible, InputBox.Visible, TeleportButton.Visible, FarmOreButton.Visible, BuyFoodButton.Visible, SellButton.Visible = false, false, false, false, false, false
        CollapseButton.Text = "[+]"
    else
        targetSize = originalSize
        CoordinateLabel.Visible, InputBox.Visible, TeleportButton.Visible, FarmOreButton.Visible, BuyFoodButton.Visible, SellButton.Visible = true, true, true, true, true, true
        CollapseButton.Text = "–"
    end
    TweenService:Create(MainFrame, tweenInfo, {Size = targetSize}):Play()
end

-- Function: Teleport
local function teleportPlayer()
    local text = InputBox.Text
    local parts = text:split(",")
    if #parts == 3 then
        local x, y, z = tonumber(parts[1]), tonumber(parts[2]), tonumber(parts[3])
        if x and y and z and Character and HumanoidRootPart then
            HumanoidRootPart.CFrame = CFrame.new(x, y, z)
            InputBox.Text = ""
        else
            InputBox.Text = "Error: Invalid Format"
        end
    else
        InputBox.Text = "Error: Use X,Y,Z"
    end
end

-- Function to execute one step of the farm route
local function executeFarmStep()
    local char = LocalPlayer.Character
    local rootPart = char and char:FindFirstChild("HumanoidRootPart")
    local humanoid = char and char:FindFirstChildOfClass("Humanoid")
    if not rootPart or not humanoid or not isOreFarmLoopActive then return end
    rootPart.CFrame = CFrame.new(-350, 16, -2501)
    task.wait(0.1)
    humanoid:MoveTo(farmDestination)
end

-- =============================================
--      Automatic 5-Minute Rock Processing
-- =============================================
local function startAutoProcessLoop()
    while isOreFarmLoopActive do
        task.wait(300) -- รอ 5 นาที
        
        if not isOreFarmLoopActive then break end
        
        local currentCharacter = LocalPlayer.Character
        
        if currentCharacter then
            print("Auto-processing Rock...")
            NetworkEvent:FireServer("fire", nil, "Process", "Rock")
            -- <<<<<<<<<<<<<<< นำเทเลพอร์ตออกจากตรงนี้แล้ว >>>>>>>>>>>>>>>
        else
            print("Character not found, skipping process cycle.")
        end
    end
end

-- Function to toggle the farm loop
local function toggleOreFarmLoop()
    isOreFarmLoopActive = not isOreFarmLoopActive
    
    if isOreFarmLoopActive then
        FarmOreButton.Text = "หยุดฟามแร่"
        FarmOreButton.BackgroundColor3 = Color3.fromRGB(200, 40, 40)
        executeFarmStep()
        
        print("Auto-processing timer started (5 minutes).")
        autoProcessCoroutine = coroutine.create(startAutoProcessLoop)
        coroutine.resume(autoProcessCoroutine)
    else
        FarmOreButton.Text = "ฟามแร่"
        FarmOreButton.BackgroundColor3 = Color3.fromRGB(0, 170, 80)
        
        if autoProcessCoroutine then
            coroutine.close(autoProcessCoroutine)
            autoProcessCoroutine = nil
            print("Auto-processing timer stopped.")
        end
    end
end

-- =============================================
--      Automatic 20-Minute Auto-Eat/Drink
-- =============================================
task.spawn(function()
    while true do
        task.wait(1200) -- รอ 20 นาที
        
        print("Auto-using Bread...")
        NetworkEvent:FireServer("fire", nil, "Use Item", "Bread")
        
        task.wait(10) -- รอ 10 วินาที
        
        print("Auto-using Water...")
        NetworkEvent:FireServer("fire", nil, "Use Item", "Water")
    end
end)

-- Function: Buy Food
local function buyFood()
    if not Character or not HumanoidRootPart then return end
    HumanoidRootPart.CFrame = CFrame.new(3000, 16, 2280)
    task.wait(0.2)
    NetworkEvent:FireServer("fire", nil, "Supermarket", "Water", 15)
    task.wait(0.2)
    NetworkEvent:FireServer("fire", nil, "Supermarket", "Bread", 15)
end

-- Function: Sell Rock
local function sellRock()
    if not Character or not HumanoidRootPart then return end
    HumanoidRootPart.CFrame = CFrame.new(2855, 17, 2108)
    task.wait(0.2)
    NetworkEvent:FireServer("fire", nil, "Economy", "Rock", 100)
end

-- =============================================
--      Event Connections
-- =============================================
CollapseButton.MouseButton1Click:Connect(toggleCollapse)
TeleportButton.MouseButton1Click:Connect(teleportPlayer)
FarmOreButton.MouseButton1Click:Connect(toggleOreFarmLoop)
BuyFoodButton.MouseButton1Click:Connect(buyFood)
SellButton.MouseButton1Click:Connect(sellRock)

-- Re-establish the HumanoidRootPart connection if the character respawns
LocalPlayer.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
end)

print("Coordinate UI (Final Version) Loaded Successfully.")
