
local VirtualInputManager = game:GetService("VirtualInputManager")

local keyToPress = Enum.KeyCode.Space

while true do

    task.wait(300)

    VirtualInputManager:SendKeyEvent(true, keyToPress, false, game)

    task.wait(0.1)

    VirtualInputManager:SendKeyEvent(false, keyToPress, false, game)
    
    print("Anti-AFK: Correctly simulated a key press at " .. os.date("%X"))
end

--[[
Â  Â  Merged Control Panel & UI Script
Â  Â  Creator: Gemini
Â  Â  Version: 3.3 (Anti-AFK Feature)

Â  Â  Description:
Â  Â  This script provides a comprehensive control panel for players, including teleportation,
Â  Â  automated farming, and player interaction. It also includes a separate, dedicated UIÂ 
Â  Â  element to display the player's "Diamond" count from their Inventory attributes.

Â  Â  Update v3.3:
Â  Â  - Added an anti-AFK feature to prevent disconnection from the server during inactivity.

Â  Â  Installation:
Â  Â  Place this LocalScript inside StarterPlayer > StarterPlayerScripts.
]]

-- =============================================
-- Settings
-- =============================================
local DIAMOND_ATTRIBUTE_NAME = "Diamond" -- Attribute to display on the counter UI.

-- =============================================
-- Service Definitions
-- =============================================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local PathfindingService = game:GetService("PathfindingService")

-- =============================================
-- [MODIFIED] Make workspace.Folder cleanup more robust
-- =============================================
-- Initial check in case the folder already exists at script start
local existingFolder = Workspace:FindFirstChild("Folder")
if existingFolder then
Â  Â  existingFolder:Destroy()
Â  Â  print("Workspace.Folder found on startup and was deleted.")
end

-- Listen for the folder being added in the future to ensure it's always deleted
Workspace.ChildAdded:Connect(function(child)
Â  Â  if child.Name == "Folder" then
Â  Â  Â  Â  task.wait() -- Allow the object to be fully parented before destroying
Â  Â  Â  Â  child:Destroy()
Â  Â  Â  Â  print("Workspace.Folder was added and has now been deleted.")
Â  Â  end
end)


-- Ensure this script only runs on the client
if not RunService:IsClient() then
Â  Â  return
end

-- =============================================
-- Local Player & Character Setup
-- =============================================
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local inventoryFolder = LocalPlayer:WaitForChild("Inventory")
local NetworkEvent

-- Safely get NetworkEvent
pcall(function()
Â  Â  NetworkEvent = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("NetworkFramework"):WaitForChild("NetworkEvent")
end)

-- Clean up old UI if it exists
pcall(function()
Â  Â  if PlayerGui:FindFirstChild("CoordinateUI") then PlayerGui.CoordinateUI:Destroy() end
Â  Â  if PlayerGui:FindFirstChild("PlayerTeleportGui") then PlayerGui.PlayerTeleportGui:Destroy() end
Â  Â  if PlayerGui:FindFirstChild("CombinedControlUI") then PlayerGui.CombinedControlUI:Destroy() end
Â  Â  if PlayerGui:FindFirstChild("ItemCounterGui") then PlayerGui.ItemCounterGui:Destroy() end -- Cleanup for diamond counter
end)

-- =============================================
-- UI Elements (Global Scope)
-- =============================================
local ControlPanelFrame
local playerListFrame -- For player teleport list

-- =============================================
-- Teleport to Player Logic
-- =============================================
local function teleportToPlayerObject(targetPlayer)
Â  Â  local localCharacter = LocalPlayer.Character
Â  Â  local characterFolder = Workspace:FindFirstChild("Character")
Â  Â  local targetObject = characterFolder and characterFolder:FindFirstChild(targetPlayer.Name)

Â  Â  if localCharacter and localCharacter:FindFirstChild("HumanoidRootPart") and targetObject then
Â  Â  Â  Â  local targetPosition
Â  Â  Â  Â  if targetObject:IsA("Model") and targetObject.PrimaryPart then
Â  Â  Â  Â  Â  Â  targetPosition = targetObject.PrimaryPart.CFrame.Position
Â  Â  Â  Â  elseif targetObject:IsA("BasePart") then
Â  Â  Â  Â  Â  Â  targetPosition = targetObject.Position
Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  warn("Could not determine position for target object: '" .. targetObject.Name .. "'")
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  end

Â  Â  Â  Â  local success, err = pcall(function()
Â  Â  Â  Â  Â  Â  print("Teleporting to " .. targetPlayer.Name .. "'s object...")
Â  Â  Â  Â  Â  Â  localCharacter.HumanoidRootPart.CFrame = CFrame.new(targetPosition + Vector3.new(0, 5, 0))
Â  Â  Â  Â  end)
Â  Â  Â  Â  if not success then warn("Teleport failed: ", err) end
Â  Â  else
Â  Â  Â  Â  if not targetObject then
Â  Â  Â  Â  Â  Â  print("Teleport failed: Cannot find object for player '" .. targetPlayer.Name .. "'")
Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  print("Teleport failed: Local player's character not found.")
Â  Â  Â  Â  end
Â  Â  end
end

local function updatePlayerList()
Â  Â  if not playerListFrame or not playerListFrame.Parent then return end

Â  Â  local existingButtons = {}
Â  Â  for _, child in ipairs(playerListFrame:GetChildren()) do
Â  Â  Â  Â  if child:IsA("TextButton") then existingButtons[child.Name] = child end
Â  Â  end
Â  Â Â 
Â  Â  local characterFolder = Workspace:FindFirstChild("Character")

Â  Â  if characterFolder then
Â  Â  Â  Â  for _, player in ipairs(Players:GetPlayers()) do
Â  Â  Â  Â  Â  Â  if player == LocalPlayer then continue end
Â  Â  Â  Â  Â  Â  local targetObject = characterFolder:FindFirstChild(player.Name)
Â  Â  Â  Â  Â  Â  if targetObject then
Â  Â  Â  Â  Â  Â  Â  Â  if not existingButtons[player.Name] then
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  local playerButton = Instance.new("TextButton")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerButton.Name = player.Name
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerButton.Text = player.DisplayName
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerButton.Size = UDim2.new(1, 0, 0, 30)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerButton.TextColor3 = Color3.fromRGB(255, 255, 255)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerButton.Font = Enum.Font.SourceSans
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerButton.TextSize = 16
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerButton.Parent = playerListFrame
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerButton.MouseButton1Click:Connect(function()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  teleportToPlayerObject(player)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  end)
Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  Â  Â  existingButtons[player.Name] = nil
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  end

Â  Â  for _, button in pairs(existingButtons) do
Â  Â  Â  Â  button:Destroy()
Â  Â  end
end

-- =============================================
-- UI Creation Functions
-- =============================================

-- [MERGED] Diamond Counter UI Creation (Fixed Size and Position)
local function createDiamondCounterUI()
Â  Â  local screenGui = Instance.new("ScreenGui")
Â  Â  screenGui.Name = "ItemCounterGui"
Â  Â  screenGui.ResetOnSpawn = false
Â  Â  screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
Â  Â Â 
Â  Â  local shadowFrame = Instance.new("Frame")
Â  Â  shadowFrame.Name = "ShadowFrame"
Â  Â  shadowFrame.BackgroundColor3 = Color3.new(0, 0, 0)
Â  Â  shadowFrame.BackgroundTransparency = 0.6
Â  Â  shadowFrame.BorderSizePixel = 0
Â  Â  shadowFrame.Position = UDim2.new(0, 15 + 3, 0, 15 + 3)Â 
Â  Â  shadowFrame.Size = UDim2.new(0, 220, 0, 60)
Â  Â  shadowFrame.ZIndex = 1
Â  Â  shadowFrame.Parent = screenGui
Â  Â Â 
Â  Â  local shadowCorner = Instance.new("UICorner")
Â  Â  shadowCorner.CornerRadius = UDim.new(0, 12)
Â  Â  shadowCorner.Parent = shadowFrame
Â  Â Â 
Â  Â  local mainFrame = Instance.new("Frame")
Â  Â  mainFrame.Name = "CounterFrame"
Â  Â  mainFrame.BackgroundColor3 = Color3.fromRGB(40, 42, 54)
Â  Â  mainFrame.BorderColor3 = Color3.fromRGB(140, 140, 140)
Â  Â  mainFrame.BorderSizePixel = 1
Â  Â  mainFrame.Position = UDim2.new(0, 15, 0, 15)
Â  Â  mainFrame.Size = UDim2.new(0, 220, 0, 60)
Â  Â  mainFrame.ZIndex = 2
Â  Â  mainFrame.Parent = screenGui
Â  Â Â 
Â  Â  local uiCorner = Instance.new("UICorner")
Â  Â  uiCorner.CornerRadius = UDim.new(0, 12)
Â  Â  uiCorner.Parent = mainFrame
Â  Â Â 
Â  Â  local titleLabel = Instance.new("TextLabel")
Â  Â  titleLabel.Name = "Title"
Â  Â  titleLabel.Text = DIAMOND_ATTRIBUTE_NAME .. ":"
Â  Â  titleLabel.TextColor3 = Color3.fromRGB(248, 248, 242)
Â  Â  titleLabel.BackgroundTransparency = 1
Â  Â  titleLabel.Font = Enum.Font.SourceSansBold
Â  Â  titleLabel.TextSize = 24
Â  Â  titleLabel.TextXAlignment = Enum.TextXAlignment.Left
Â  Â  titleLabel.Position = UDim2.new(0, 15, 0.5, 0)
Â  Â  titleLabel.Size = UDim2.new(1, -95, 0, 30)
Â  Â  titleLabel.AnchorPoint = Vector2.new(0, 0.5)
Â  Â  titleLabel.Parent = mainFrame
Â  Â Â 
Â  Â  local countLabel = Instance.new("TextLabel")
Â  Â  countLabel.Name = "Count"
Â  Â  countLabel.Text = "..."
Â  Â  countLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
Â  Â  countLabel.BackgroundTransparency = 1
Â  Â  countLabel.Font = Enum.Font.SourceSansBold
Â  Â  countLabel.TextSize = 28
Â  Â  countLabel.TextXAlignment = Enum.TextXAlignment.Right
Â  Â  countLabel.Position = UDim2.new(1, -15, 0.5, 0)
Â  Â  countLabel.Size = UDim2.new(0, 80, 0, 30)
Â  Â  countLabel.AnchorPoint = Vector2.new(1, 0.5)
Â  Â  countLabel.Parent = mainFrame
Â  Â Â 
Â  Â  screenGui.Parent = PlayerGui
Â  Â Â 
Â  Â  return countLabel
end

-- Control Panel UI Creation (Responsive)
local function createControlPanelUI()
Â  Â  local ScreenGui = Instance.new("ScreenGui"); ScreenGui.Name = "CombinedControlUI"; ScreenGui.ResetOnSpawn = false; ScreenGui.Parent = PlayerGui

Â  Â  -- [NEW] Add UIAspectRatioConstraint to make the UI responsive
Â  Â  local AspectRatioConstraint = Instance.new("UIAspectRatioConstraint")
Â  Â  AspectRatioConstraint.AspectRatio = 250 / 320
Â  Â  AspectRatioConstraint.DominantAxis = Enum.DominantAxis.Height
Â  Â  AspectRatioConstraint.Parent = ScreenGui

Â  Â  -- Main Draggable Frame
Â  Â  ControlPanelFrame = Instance.new("Frame"); ControlPanelFrame.Name = "ControlPanelFrame";Â 
Â  Â  ControlPanelFrame.Size = UDim2.new(0, 250, 0, 320) -- Using offset for the constraint to work correctly
Â  Â  ControlPanelFrame.Position = UDim2.new(0.5, 0, 0.5, 0);Â 
Â  Â  ControlPanelFrame.AnchorPoint = Vector2.new(0.5, 0.5); -- Center the frame
Â  Â  ControlPanelFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40); ControlPanelFrame.BorderSizePixel = 0; ControlPanelFrame.Active = true; ControlPanelFrame.Draggable = true; ControlPanelFrame.ClipsDescendants = true; ControlPanelFrame.Parent = ScreenGui
Â  Â  local UICorner_Main = Instance.new("UICorner", ControlPanelFrame); UICorner_Main.CornerRadius = UDim.new(0, 8)

Â  Â  -- Title Bar
Â  Â  local TitleBar = Instance.new("Frame"); TitleBar.Name = "TitleBar"; TitleBar.Size = UDim2.new(1, 0, 0, 30); TitleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 60); TitleBar.BorderSizePixel = 0; TitleBar.Parent = ControlPanelFrame
Â  Â  local UICorner_Title = Instance.new("UICorner", TitleBar); UICorner_Title.CornerRadius = UDim.new(0, 8)
Â  Â  local TitleLabel = Instance.new("TextLabel"); TitleLabel.Parent = TitleBar; TitleLabel.Name = "TitleLabel"; TitleLabel.Size = UDim2.new(1, -40, 1, 0); TitleLabel.Position = UDim2.new(0, 10, 0, 0); TitleLabel.BackgroundTransparency = 1; TitleLabel.Font = Enum.Font.SourceSansBold; TitleLabel.Text = "Control Panel"; TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255); TitleLabel.TextSize = 18; TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
Â  Â  local CollapseButton = Instance.new("TextButton"); CollapseButton.Parent = TitleBar; CollapseButton.Name = "CollapseButton"; CollapseButton.Size = UDim2.new(0, 20, 0, 20); CollapseButton.Position = UDim2.new(1, -25, 0.5, -10); CollapseButton.BackgroundColor3 = Color3.fromRGB(60, 60, 75); CollapseButton.Font = Enum.Font.SourceSansBold; CollapseButton.Text = "â€“"; CollapseButton.TextColor3 = Color3.fromRGB(255, 255, 255); CollapseButton.TextSize = 18
Â  Â  local UICorner_Collapse = Instance.new("UICorner", CollapseButton); UICorner_Collapse.CornerRadius = UDim.new(0, 4)

Â  Â  -- Tab Container
Â  Â  local TabContainer = Instance.new("Frame"); TabContainer.Name = "TabContainer"; TabContainer.Size = UDim2.new(1, 0, 0, 30); TabContainer.Position = UDim2.new(0, 0, 0, 30); TabContainer.BackgroundTransparency = 1; TabContainer.Parent = ControlPanelFrame
Â  Â  local ControlsTabButton = Instance.new("TextButton"); ControlsTabButton.Name = "ControlsTabButton"; ControlsTabButton.Size = UDim2.new(0.5, 0, 1, 0); ControlsTabButton.BackgroundColor3 = Color3.fromRGB(60, 60, 80); ControlsTabButton.Font = Enum.Font.SourceSansBold; ControlsTabButton.Text = "Controls"; ControlsTabButton.TextColor3 = Color3.fromRGB(255, 255, 255); ControlsTabButton.TextSize = 16; ControlsTabButton.Parent = TabContainer
Â  Â  local PlayersTabButton = Instance.new("TextButton"); PlayersTabButton.Name = "PlayersTabButton"; PlayersTabButton.Size = UDim2.new(0.5, 0, 1, 0); PlayersTabButton.Position = UDim2.new(0.5, 0, 0, 0); PlayersTabButton.BackgroundColor3 = Color3.fromRGB(40, 40, 50); PlayersTabButton.Font = Enum.Font.SourceSansBold; PlayersTabButton.Text = "Players"; PlayersTabButton.TextColor3 = Color3.fromRGB(200, 200, 200); PlayersTabButton.TextSize = 16; PlayersTabButton.Parent = TabContainer

Â  Â  -- Content Frames for Tabs
Â  Â  local ContentContainer = Instance.new("Frame"); ContentContainer.Name = "ContentContainer"; ContentContainer.Size = UDim2.new(1, 0, 1, -60); ContentContainer.Position = UDim2.new(0, 0, 0, 60); ContentContainer.BackgroundTransparency = 1; ContentContainer.Parent = ControlPanelFrame
Â  Â Â 
Â  Â  -- Controls Content
Â  Â  local ControlsContentFrame = Instance.new("Frame"); ControlsContentFrame.Name = "ControlsContent"; ControlsContentFrame.Size = UDim2.new(1, 0, 1, 0); ControlsContentFrame.BackgroundTransparency = 1; ControlsContentFrame.Parent = ContentContainer; ControlsContentFrame.Visible = true
Â  Â  local CoordinateLabel = Instance.new("TextLabel"); CoordinateLabel.Parent = ControlsContentFrame; CoordinateLabel.Name = "CoordinateLabel"; CoordinateLabel.Size = UDim2.new(1, -20, 0, 30); CoordinateLabel.Position = UDim2.new(0, 10, 0, 0); CoordinateLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 65); CoordinateLabel.Font = Enum.Font.SourceSansBold; CoordinateLabel.Text = "X: 0.0, Y: 0.0, Z: 0.0"; CoordinateLabel.TextColor3 = Color3.fromRGB(200, 200, 200); CoordinateLabel.TextSize = 16
Â  Â  local UICorner_CoordLabel = Instance.new("UICorner", CoordinateLabel); UICorner_CoordLabel.CornerRadius = UDim.new(0, 6)
Â  Â  local InputBox = Instance.new("TextBox"); InputBox.Parent = ControlsContentFrame; InputBox.Name = "InputBox"; InputBox.Size = UDim2.new(1, -70, 0, 30); InputBox.Position = UDim2.new(0, 10, 0, 40); InputBox.BackgroundColor3 = Color3.fromRGB(50, 50, 65); InputBox.Font = Enum.Font.SourceSans; InputBox.Text = "X, Y, Z"; InputBox.TextColor3 = Color3.fromRGB(200, 200, 200); InputBox.TextSize = 16; InputBox.ClearTextOnFocus = true
Â  Â  local UICorner_InputBox = Instance.new("UICorner", InputBox); UICorner_InputBox.CornerRadius = UDim.new(0, 6)
Â  Â  local TeleportButton = Instance.new("TextButton"); TeleportButton.Parent = ControlsContentFrame; TeleportButton.Name = "TeleportButton"; TeleportButton.Size = UDim2.new(0, 50, 0, 30); TeleportButton.Position = UDim2.new(1, -60, 0, 40); TeleportButton.BackgroundColor3 = Color3.fromRGB(0, 150, 200); TeleportButton.Font = Enum.Font.SourceSansBold; TeleportButton.Text = "Go"; TeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255); TeleportButton.TextSize = 16
Â  Â  local UICorner_TeleportBtn = Instance.new("UICorner", TeleportButton); UICorner_TeleportBtn.CornerRadius = UDim.new(0, 6)
Â  Â  local FarmOreButton = Instance.new("TextButton"); FarmOreButton.Parent = ControlsContentFrame; FarmOreButton.Name = "FarmOreButton"; FarmOreButton.Size = UDim2.new(1, -20, 0, 30); FarmOreButton.Position = UDim2.new(0, 10, 0, 80); FarmOreButton.BackgroundColor3 = Color3.fromRGB(0, 170, 80); FarmOreButton.Font = Enum.Font.SourceSansBold; FarmOreButton.Text = "à¸Ÿà¸²à¸¡à¹à¸£à¹ˆ"; FarmOreButton.TextColor3 = Color3.fromRGB(255, 255, 255); FarmOreButton.TextSize = 16
Â  Â  local UICorner_FarmOreBtn = Instance.new("UICorner", FarmOreButton); UICorner_FarmOreBtn.CornerRadius = UDim.new(0, 6)
Â  Â  local BuyFoodButton = Instance.new("TextButton"); BuyFoodButton.Name = "BuyFoodButton"; BuyFoodButton.Size = UDim2.new(1, -20, 0, 30); BuyFoodButton.Position = UDim2.new(0, 10, 0, 120); BuyFoodButton.BackgroundColor3 = Color3.fromRGB(255, 180, 0); BuyFoodButton.Font = Enum.Font.SourceSansBold; BuyFoodButton.Text = "à¸‹à¸·à¹‰à¸­à¸­à¸²à¸«à¸²à¸£"; BuyFoodButton.TextColor3 = Color3.fromRGB(255, 255, 255); BuyFoodButton.TextSize = 16; BuyFoodButton.Parent = ControlsContentFrame
Â  Â  local UICorner_BuyFoodBtn = Instance.new("UICorner", BuyFoodButton); UICorner_BuyFoodBtn.CornerRadius = UDim.new(0, 6)
Â  Â  local WalkToSellButton = Instance.new("TextButton"); WalkToSellButton.Name = "WalkToSellButton"; WalkToSellButton.Size = UDim2.new(1, -20, 0, 30); WalkToSellButton.Position = UDim2.new(0, 10, 0, 160); WalkToSellButton.BackgroundColor3 = Color3.fromRGB(150, 50, 200); WalkToSellButton.Font = Enum.Font.SourceSansBold; WalkToSellButton.Text = "à¹€à¸”à¸´à¸™à¹„à¸›à¸ˆà¸¸à¸”à¸‚à¸²à¸¢"; WalkToSellButton.TextColor3 = Color3.fromRGB(255, 255, 255); WalkToSellButton.TextSize = 16; WalkToSellButton.Parent = ControlsContentFrame
Â  Â  local UICorner_WalkSellBtn = Instance.new("UICorner", WalkToSellButton); UICorner_WalkSellBtn.CornerRadius = UDim.new(0, 6)

Â  Â  -- Players Content
Â  Â  local PlayersContentFrame = Instance.new("Frame"); PlayersContentFrame.Name = "PlayersContent"; PlayersContentFrame.Size = UDim2.new(1, 0, 1, 0); PlayersContentFrame.BackgroundTransparency = 1; PlayersContentFrame.Parent = ContentContainer; PlayersContentFrame.Visible = false
Â  Â  local WarpToKealohaButton = Instance.new("TextButton"); WarpToKealohaButton.Name = "WarpToKealohaButton"; WarpToKealohaButton.Size = UDim2.new(1, -20, 0, 30); WarpToKealohaButton.Position = UDim2.new(0, 10, 0, 5); WarpToKealohaButton.BackgroundColor3 = Color3.fromRGB(220, 120, 0); WarpToKealohaButton.Font = Enum.Font.SourceSansBold; WarpToKealohaButton.Text = "à¸§à¸²à¸›à¸«à¸² KealohaWeaver5712"; WarpToKealohaButton.TextColor3 = Color3.fromRGB(255, 255, 255); WarpToKealohaButton.TextSize = 16; WarpToKealohaButton.Parent = PlayersContentFrame
Â  Â  local UICorner_WarpKealohaBtn = Instance.new("UICorner", WarpToKealohaButton); UICorner_WarpKealohaBtn.CornerRadius = UDim.new(0, 6)
Â  Â  playerListFrame = Instance.new("ScrollingFrame"); playerListFrame.Name = "PlayerListFrame"; playerListFrame.Parent = PlayersContentFrame; playerListFrame.Size = UDim2.new(1, -20, 1, -45); playerListFrame.Position = UDim2.new(0, 10, 0, 40); playerListFrame.BackgroundTransparency = 1; playerListFrame.BorderSizePixel = 0; playerListFrame.CanvasSize = UDim2.new(0, 0, 0, 0); playerListFrame.ScrollBarImageColor3 = Color3.fromRGB(180, 180, 180); playerListFrame.ScrollBarThickness = 8
Â  Â  local listLayout = Instance.new("UIListLayout"); listLayout.Parent = playerListFrame; listLayout.SortOrder = Enum.SortOrder.Name; listLayout.Padding = UDim.new(0, 5); listLayout.FillDirection = Enum.FillDirection.Vertical; listLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

Â  Â  return {
Â  Â  Â  Â  ScreenGui = ScreenGui,
Â  Â  Â  Â  CollapseButton = CollapseButton,
Â  Â  Â  Â  CoordinateLabel = CoordinateLabel,
Â  Â  Â  Â  InputBox = InputBox,
Â  Â  Â  Â  TeleportButton = TeleportButton,
Â  Â  Â  Â  FarmOreButton = FarmOreButton,
Â  Â  Â  Â  BuyFoodButton = BuyFoodButton,
Â  Â  Â  Â  WalkToSellButton = WalkToSellButton,
Â  Â  Â  Â  WarpToKealohaButton = WarpToKealohaButton,
Â  Â  Â  Â  ControlsTabButton = ControlsTabButton,
Â  Â  Â  Â  PlayersTabButton = PlayersTabButton,
Â  Â  Â  Â  ControlsContentFrame = ControlsContentFrame,
Â  Â  Â  Â  PlayersContentFrame = PlayersContentFrame
Â  Â  }
end

-- =============================================
-- Logic & Functions (Merged & Stabilized)
-- =============================================
-- State Variables
local isCollapsed = false
local originalSize = UDim2.new(0, 250, 0, 320)
local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local isOreFarmLoopActive = false
local inventoryConnection = nil
local isWaitingForRockToClear = false
local lastPosition = Vector3.new()
local timeStationary = 0
local antiStuckThreshold = 5
-- [NEW] State variables for ore-specific anti-stuck
local currentTargetOre = nil
local timeAtOreStationary = 0
local antiStuckAtOreThreshold = 10 -- User-defined 10 seconds
local distanceToOreThreshold = 3Â  Â -- User-defined 3 studs distance

-- [MERGED] Logic for Diamond Counter
local function setupDiamondCounter(countLabel)
Â  Â  if not inventoryFolder thenÂ 
Â  Â  Â  Â  warn("Diamond Counter: Inventory folder not found!")
Â  Â  Â  Â  return
Â  Â  end

Â  Â  local function updateAttributeCount()
Â  Â  Â  Â  local amount = inventoryFolder:GetAttribute(DIAMOND_ATTRIBUTE_NAME) or 0
Â  Â  Â  Â  countLabel.Text = tostring(amount)
Â  Â  end

Â  Â  updateAttributeCount() -- Initial update

Â  Â  inventoryFolder.AttributeChanged:Connect(function(attributeName)
Â  Â  Â  Â  if attributeName == DIAMOND_ATTRIBUTE_NAME then
Â  Â  Â  Â  Â  Â  updateAttributeCount()
Â  Â  Â  Â  end
Â  Â  end)
Â  Â  print("Diamond Counter UI logic initialized.")
end


-- New function to safely create the list of objects to track
local function getObjectsToTrack()
Â  Â  local trackList = {}
Â  Â  local farm = Workspace:FindFirstChild("Farm")
Â  Â  if not farm then
Â  Â  Â  Â  warn("'Farm' folder not found in Workspace.")
Â  Â  Â  Â  return trackList
Â  Â  end

Â  Â  local rockFolder = farm:FindFirstChild("Rock")
Â  Â  if not rockFolder then
Â  Â  Â  Â  warn("'Rock' folder not found in Workspace.Farm.")
Â  Â  Â  Â  return trackList
Â  Â  end

Â  Â  for _, child in ipairs(rockFolder:GetChildren()) do
Â  Â  Â  Â  if child:IsA("PVInstance") then
Â  Â  Â  Â  Â  Â  table.insert(trackList, child)
Â  Â  Â  Â  end
Â  Â  end
Â  Â Â 
Â  Â  return trackList
end

-- Pathfinding walk function
local function findAndWalkToClosestOre(oreToExclude) -- [MODIFIED] Added parameter
Â  Â  local character = LocalPlayer.Character
Â  Â  if not character then return end
Â  Â  local humanoid = character:FindFirstChildOfClass("Humanoid")
Â  Â  local rootPart = character:FindFirstChild("HumanoidRootPart")
Â  Â Â 
Â  Â  if not (humanoid and rootPart and humanoid.Health > 0 and isOreFarmLoopActive) then return end

Â  Â  task.wait(0.5)

Â  Â  local objectsToTrack = getObjectsToTrack()
Â  Â  if #objectsToTrack == 0 then
Â  Â  Â  Â  warn("No objects to track were found. Aborting walk.")
		currentTargetOre = nil -- [NEW] Reset target ore
Â  Â  Â  Â  return
Â  Â  end

Â  Â  local closestObject, minDistance = nil, math.huge
Â  Â  for _, obj in ipairs(objectsToTrack) do
Â  Â  Â  Â  -- [MODIFIED] Check if the object is valid and not the one to exclude
Â  Â  Â  Â  if obj and obj.Parent and obj ~= oreToExclude then
Â  Â  Â  Â  Â  Â  local dist = (rootPart.Position - obj.WorldPivot.Position).Magnitude
Â  Â  Â  Â  Â  Â  if dist < minDistance then
Â  Â  Â  Â  Â  Â  Â  Â  minDistance, closestObject = dist, obj
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  end

Â  Â  if closestObject then
		currentTargetOre = closestObject -- [NEW] Set the new target ore
Â  Â  Â  Â  print("Walking to closest object:", closestObject:GetFullName(), ". Calculating path...")
Â  Â  Â  Â Â 
Â  Â  Â  Â  local agentParameters = { AgentRadius = 3, AgentHeight = 6, AgentCanJump = true }
Â  Â  Â  Â  local path = PathfindingService:CreatePath(agentParameters)
Â  Â  Â  Â Â 
Â  Â  Â  Â  local success, errorMessage = pcall(function()
Â  Â  Â  Â  Â  Â  path:ComputeAsync(rootPart.Position, closestObject.WorldPivot.Position)
Â  Â  Â  Â  end)

Â  Â  Â  Â  if success and path.Status == Enum.PathStatus.Success then
Â  Â  Â  Â  Â  Â  print("Path calculated. Following waypoints...")
Â  Â  Â  Â  Â  Â  local waypoints = path:GetWaypoints()
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  local pathBlockedConnection
Â  Â  Â  Â  Â  Â  local function onPathBlocked(blockedWaypointIndex)
Â  Â  Â  Â  Â  Â  Â  Â  if blockedWaypointIndex < #waypoints then
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  print("Path blocked at waypoint " .. blockedWaypointIndex .. ". Recalculating...")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if pathBlockedConnection then pathBlockedConnection:Disconnect() end
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  findAndWalkToClosestOre(nil)
Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  pathBlockedConnection = path.Blocked:Connect(onPathBlocked)

Â  Â  Â  Â  Â  Â  for i, waypoint in ipairs(waypoints) do
Â  Â  Â  Â  Â  Â  Â  Â  if not isOreFarmLoopActive then
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  print("Farming stopped mid-path. Aborting walk.")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break
Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  Â  Â  humanoid:MoveTo(waypoint.Position)
Â  Â  Â  Â  Â  Â  Â  Â  humanoid.MoveToFinished:Wait()
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if pathBlockedConnection then pathBlockedConnection:Disconnect() end
Â  Â  Â  Â  Â  Â  print("Reached destination or path ended.")
Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  warn("Pathfinding to ore failed: ", errorMessage or "No viable path.", "Using direct walk instead.")
Â  Â  Â  Â  Â  Â  humanoid:MoveTo(closestObject.WorldPivot.Position)
Â  Â  Â  Â  end
Â  Â  else
		currentTargetOre = nil -- [NEW] Reset if no object is found
Â  Â  Â  Â  warn("Could not find any valid objects to walk to (excluding current target).")
Â  Â  end
end

-- Teleport to Coords
local function teleportPlayer(inputBox)
Â  Â  local currentCharacter = LocalPlayer.Character
Â  Â  local currentRootPart = currentCharacter and currentCharacter:FindFirstChild("HumanoidRootPart")
Â  Â  if not currentRootPart then
Â  Â  Â  Â  inputBox.Text = "Error: Character not found"
Â  Â  Â  Â  return
Â  Â  end

Â  Â  local parts = inputBox.Text:split(",")
Â  Â  if #parts == 3 then
Â  Â  Â  Â  local x, y, z = tonumber(parts[1]), tonumber(parts[2]), tonumber(parts[3])
Â  Â  Â  Â  if x and y and z then
Â  Â  Â  Â  Â  Â  currentRootPart.CFrame = CFrame.new(x, y, z)
Â  Â  Â  Â  Â  Â  inputBox.Text = ""
Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  inputBox.Text = "Error: Invalid Format"
Â  Â  Â  Â  end
Â  Â  else
Â  Â  Â  Â  inputBox.Text = "Error: Use X,Y,Z"
Â  Â  end
end

-- Farming coordinates
local initialFarmPosition = CFrame.new(-339, 40, -2713)
local postProcessFarmPosition = CFrame.new(-332, 35, -2680)

-- Farm Step for auto-resume
local function executeResumeFarmStep()
Â  Â  local currentRootPart = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
Â  Â  if not currentRootPart or not isOreFarmLoopActive then return end
Â  Â  currentRootPart.CFrame = postProcessFarmPosition
Â  Â  task.wait(0.1)
Â  Â  findAndWalkToClosestOre(nil)
end

-- Inventory change handler for farming
local function onInventoryChanged(attributeName, farmButton)
Â  Â  if not inventoryFolder then return end
Â  Â Â 
Â  Â  local rockCount = inventoryFolder:GetAttribute("Rock") or 0

Â  Â  if isOreFarmLoopActive and not isWaitingForRockToClear and rockCount >= 100 then
Â  Â  Â  Â  isWaitingForRockToClear = true
Â  Â  Â  Â  isOreFarmLoopActive = false -- Pause farming

Â  Â  Â  Â  farmButton.Text = "Waiting for Rock..."
Â  Â  Â  Â  farmButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
Â  Â  Â  Â Â 
Â  Â  Â  Â  print("Rock count reached 100. Cooldown for 2 seconds before warp.")
Â  Â  Â  Â  task.wait(2)
Â  Â  Â  Â Â 
Â  Â  Â  Â  print("Preparing to warp and process.")
Â  Â  Â  Â Â 
Â  Â  Â  Â  local currentRootPart = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
Â  Â  Â  Â Â 
Â  Â  Â  Â  if currentRootPart then
Â  Â  Â  Â  Â  Â  print("Warping to process point at:", postProcessFarmPosition.Position)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  currentRootPart.CFrame = postProcessFarmPosition
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  print("Teleport command issued. Waiting 4 seconds...")
Â  Â  Â  Â  Â  Â  task.wait(4)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  print("Wait finished. Sending 'Process' command to server...")
Â  Â  Â  Â  Â  Â  NetworkEvent:FireServer("fire", nil, "Process", "Rock")
Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  warn("Could not find HumanoidRootPart to warp. Cannot process.")
Â  Â  Â  Â  end
Â  Â  Â  Â Â 
Â  Â  elseif isWaitingForRockToClear and rockCount == 0 then
Â  Â  Â  Â  print("Rock inventory cleared. Waiting 5 seconds before resuming farming...")
Â  Â  Â  Â  task.wait(5)

Â  Â  Â  Â  if not isWaitingForRockToClear then
Â  Â  Â  Â  Â  Â  print("Farming was cancelled during the wait. Aborting resume.")
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  end
Â  Â  Â  Â Â 
Â  Â  Â  Â  print("Resuming farming...")
Â  Â  Â  Â  isWaitingForRockToClear = false
Â  Â  Â  Â  isOreFarmLoopActive = true -- Resume farming

Â  Â  Â  Â  farmButton.Text = "Stop Farming"
Â  Â  Â  Â  farmButton.BackgroundColor3 = Color3.fromRGB(200, 40, 40)
Â  Â  Â  Â Â 
Â  Â  Â  Â  executeResumeFarmStep()
Â  Â  end
end


-- Toggle Farm Loop
local function toggleOreFarmLoop(farmButton)
Â  Â  isOreFarmLoopActive = not isOreFarmLoopActive
Â  Â Â 
Â  Â  if isOreFarmLoopActive then
Â  Â  Â  Â  isWaitingForRockToClear = false
Â  Â  Â  Â  farmButton.Text = "Stop Farming"
Â  Â  Â  Â  farmButton.BackgroundColor3 = Color3.fromRGB(200, 40, 40)
Â  Â  Â  Â Â 
Â  Â  Â  Â  local currentRootPart = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
Â  Â  Â  Â  if currentRootPart then
Â  Â  Â  Â  Â  Â  lastPosition = currentRootPart.Position
Â  Â  Â  Â  Â  Â  print("Starting farm manually. Teleporting to initial position...")
Â  Â  Â  Â  Â  Â  currentRootPart.CFrame = initialFarmPosition
Â  Â  Â  Â  Â  Â  task.wait(0.1)
Â  Â  Â  Â  Â  Â  findAndWalkToClosestOre(nil)
Â  Â  Â  Â  end
Â  Â  Â  Â  timeStationary = 0
Â  Â  Â  Â Â 
Â  Â  Â  Â  if not inventoryConnection then
Â  Â  Â  Â  Â  Â  inventoryConnection = inventoryFolder.AttributeChanged:Connect(function(attributeName)
Â  Â  Â  Â  Â  Â  Â  Â  onInventoryChanged(attributeName, farmButton)
Â  Â  Â  Â  Â  Â  end)
Â  Â  Â  Â  end
Â  Â  Â  Â Â 
Â  Â  Â  Â  task.spawn(function()
Â  Â  Â  Â  Â  Â  task.wait(0.5)
Â  Â  Â  Â  Â  Â  onInventoryChanged("Rock", farmButton)
Â  Â  Â  Â  end)
Â  Â  Â  Â Â 
Â  Â  else
Â  Â  Â  Â  isWaitingForRockToClear = false
Â  Â  Â  Â  farmButton.Text = "Farm Ore"
Â  Â  Â  Â  farmButton.BackgroundColor3 = Color3.fromRGB(0, 170, 80)
Â  Â  Â  Â Â 
Â  Â  Â  Â  if inventoryConnection then
Â  Â  Â  Â  Â  Â  inventoryConnection:Disconnect()
Â  Â  Â  Â  Â  Â  inventoryConnection = nil
Â  Â  Â  Â  end
Â  Â  end
end

-- Buy/Sell/Walk Functions
local function buyFood()
Â  Â  if not NetworkEvent then warn("NetworkEvent not available for buyFood") return end
Â  Â  local currentRootPart = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
Â  Â  if not currentRootPart then return end
Â  Â  currentRootPart.CFrame = CFrame.new(3000, 16, 2280)
Â  Â  task.wait(0.2)
Â  Â  NetworkEvent:FireServer("fire", nil, "Supermarket", "Water", 15)
Â  Â  task.wait(0.2)
Â  Â  NetworkEvent:FireServer("fire", nil, "Supermarket", "Bread", 15)
end

-- Pathfinding walk to sell point
local function walkToSellPoint()
Â  Â  local character = LocalPlayer.Character
Â  Â  if not character then return end
Â  Â  local humanoid = character:FindFirstChildOfClass("Humanoid")
Â  Â  local rootPart = character:FindFirstChild("HumanoidRootPart")
Â  Â  if not (humanoid and rootPart) then return end

Â  Â  local destination = Vector3.new(2853.1, 14.5, 2108.9)
Â  Â Â 
Â  Â  local agentParameters = { AgentRadius = 3, AgentHeight = 6, AgentCanJump = true }
Â  Â  local path = PathfindingService:CreatePath(agentParameters)

Â  Â  local success, errorMessage = pcall(function()
Â  Â  Â  Â  path:ComputeAsync(rootPart.Position, destination)
Â  Â  end)

Â  Â  if success and path.Status == Enum.PathStatus.Success then
Â  Â  Â  Â  print("Path to sell point calculated. Following waypoints...")
Â  Â  Â  Â  local waypoints = path:GetWaypoints()
Â  Â  Â  Â Â 
Â  Â  Â  Â  local pathBlockedConnection
Â  Â  Â  Â  local function onPathBlocked(blockedWaypointIndex)
Â  Â  Â  Â  Â  Â  if blockedWaypointIndex < #waypoints then
Â  Â  Â  Â  Â  Â  Â  Â  print("Path to sell point blocked. Recalculating...")
Â  Â  Â  Â  Â  Â  Â  Â  if pathBlockedConnection then pathBlockedConnection:Disconnect() end
Â  Â  Â  Â  Â  Â  Â  Â  walkToSellPoint() -- Restart the walk
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  Â  Â  pathBlockedConnection = path.Blocked:Connect(onPathBlocked)

Â  Â  Â  Â  for _, waypoint in ipairs(waypoints) do
Â  Â  Â  Â  Â  Â  humanoid:MoveTo(waypoint.Position)
Â  Â  Â  Â  Â  Â  humanoid.MoveToFinished:Wait()
Â  Â  Â  Â  end
Â  Â  Â  Â Â 
Â  Â  Â  Â  if pathBlockedConnection then pathBlockedConnection:Disconnect() end
Â  Â  Â  Â  print("Arrived at the sell point.")
Â  Â  else
Â  Â  Â  Â  warn("Pathfinding to sell point failed: ", errorMessage or "No path found.", "Using direct walk instead.")
Â  Â  Â  Â  humanoid:MoveTo(destination)
Â  Â  end
end

local function warpToKealoha()
Â  Â  local targetPlayerName = "KealohaWeaver5712"
Â  Â  local targetPlayer = Players:FindFirstChild(targetPlayerName)
Â  Â Â 
Â  Â  if targetPlayer then
Â  Â  Â  Â  print("Found player " .. targetPlayerName .. ". Attempting to teleport.")
Â  Â  Â  Â  teleportToPlayerObject(targetPlayer)
Â  Â  else
Â  Â  Â  Â  warn("Player " .. targetPlayerName .. " not found in the game.")
Â  Â  end
end

-- =============================================
-- Main Execution & Event Connections
-- =============================================
-- Create UIs
local UIElements = createControlPanelUI()
local diamondCountLabel = createDiamondCounterUI()

-- Setup Logic
setupDiamondCounter(diamondCountLabel)

-- Update Loop
RunService.RenderStepped:Connect(function(deltaTime)
Â  Â  if HumanoidRootPart and not isCollapsed then
Â  Â  Â  Â  local pos = HumanoidRootPart.Position
Â  Â  Â  Â  UIElements.CoordinateLabel.Text = string.format("X: %.1f, Y: %.1f, Z: %.1f", pos.X, pos.Y, pos.Z)
Â  Â  end
Â  Â  if not isOreFarmLoopActive or not (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")) then return end
Â  Â Â 
Â  Â  local currentPos = LocalPlayer.Character.HumanoidRootPart.Position
Â  Â  local isStationary = (currentPos - lastPosition).Magnitude < 0.5

Â  Â  -- General Anti-Stuck Logic
Â  Â  if isStationary then
Â  Â  Â  Â  timeStationary += deltaTime
Â  Â  else
Â  Â  Â  Â  timeStationary = 0
Â  Â  Â  Â  lastPosition = currentPos
Â  Â  end
Â  Â Â 
Â  Â  if timeStationary >= antiStuckThreshold then
Â  Â  Â  Â  print("Anti-Stuck Triggered (General). Re-pathing...")
Â  Â  Â  Â  findAndWalkToClosestOre(nil) -- [MODIFIED] Call new function
Â  Â  Â  Â  timeStationary = 0
Â  Â  Â  Â  timeAtOreStationary = 0 -- [NEW] Reset ore timer as well
Â  Â  end

Â  Â  -- [NEW] Ore-specific Anti-Stuck Logic
Â  Â  if currentTargetOre and currentTargetOre.Parent then
Â  Â  Â  Â  local distToTarget = (currentPos - currentTargetOre.WorldPivot.Position).Magnitude

Â  Â  Â  Â  if isStationary and distToTarget <= distanceToOreThreshold then
Â  Â  Â  Â  Â  Â  timeAtOreStationary += deltaTime
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if timeAtOreStationary >= antiStuckAtOreThreshold then
Â  Â  Â  Â  Â  Â  Â  Â  print("Anti-Stuck Triggered (at Ore). Finding next closest ore...")
Â  Â  Â  Â  Â  Â  Â  Â  findAndWalkToClosestOre(currentTargetOre) -- Find next ore, excluding the current one
Â  Â  Â  Â  Â  Â  Â  Â  timeStationary = 0 -- Reset both timers
Â  Â  Â  Â  Â  Â  Â  Â  timeAtOreStationary = 0
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  -- If player moves or is far from the ore, reset the ore-specific timer
Â  Â  Â  Â  Â  Â  timeAtOreStationary = 0
Â  Â  Â  Â  end
Â  Â  else
Â  Â  Â  Â  -- If there's no target ore, this timer should be zero
Â  Â  Â  Â  timeAtOreStationary = 0
Â  Â  end
end)

-- UI Interactions
local function toggleCollapse()
Â  Â  isCollapsed = not isCollapsed
Â  Â  local targetSize = isCollapsed and UDim2.new(originalSize.X.Scale, originalSize.X.Offset, 0, 30) or originalSize

Â  Â  local contentContainer = ControlPanelFrame:FindFirstChild("ContentContainer")
Â  Â  local tabContainer = ControlPanelFrame:FindFirstChild("TabContainer")

Â  Â  if contentContainer then contentContainer.Visible = not isCollapsed end
Â  Â  if tabContainer then tabContainer.Visible = not isCollapsed end

Â  Â  UIElements.CollapseButton.Text = isCollapsed and "+" or "â€“"
Â  Â  TweenService:Create(ControlPanelFrame, tweenInfo, {Size = targetSize}):Play()
end

local function switchTab(tabName)
Â  Â  local isControls = (tabName == "Controls")
Â  Â  UIElements.ControlsContentFrame.Visible = isControls
Â  Â  UIElements.PlayersContentFrame.Visible = not isControls
Â  Â  UIElements.ControlsTabButton.BackgroundColor3 = isControls and Color3.fromRGB(60, 60, 80) or Color3.fromRGB(40, 40, 50)
Â  Â  UIElements.ControlsTabButton.TextColor3 = isControls and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(200, 200, 200)
Â  Â  UIElements.PlayersTabButton.BackgroundColor3 = not isControls and Color3.fromRGB(60, 60, 80) or Color3.fromRGB(40, 40, 50)
Â  Â  UIElements.PlayersTabButton.TextColor3 = not isControls and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(200, 200, 200)
end

UIElements.CollapseButton.MouseButton1Click:Connect(toggleCollapse)
UIElements.ControlsTabButton.MouseButton1Click:Connect(function() switchTab("Controls") end)
UIElements.PlayersTabButton.MouseButton1Click:Connect(function() switchTab("Players") end)
UIElements.TeleportButton.MouseButton1Click:Connect(function() teleportPlayer(UIElements.InputBox) end)
UIElements.FarmOreButton.MouseButton1Click:Connect(function() toggleOreFarmLoop(UIElements.FarmOreButton) end)
UIElements.BuyFoodButton.MouseButton1Click:Connect(buyFood)
UIElements.WalkToSellButton.MouseButton1Click:Connect(walkToSellPoint)
UIElements.WarpToKealohaButton.MouseButton1Click:Connect(warpToKealoha)


-- [NEW] Keybind to toggle the main control panel
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
Â  Â  -- If the user is typing in a textbox, don't toggle the UI
Â  Â  if gameProcessedEvent then return end

Â  Â  if input.KeyCode == Enum.KeyCode.F then
Â  Â  Â  Â  -- Toggle the Enabled property of the ScreenGui to show/hide it
Â  Â  Â  Â  UIElements.ScreenGui.Enabled = not UIElements.ScreenGui.Enabled
Â  Â  end
end)


-- Auto-Eat/Drink Loop
if NetworkEvent then
Â  Â  task.spawn(function()
Â  Â  Â  Â  while true do
Â  Â  Â  Â  Â  Â  task.wait(1200) -- 20 minutes
Â  Â  Â  Â  Â  Â  if LocalPlayer.Character then
Â  Â  Â  Â  Â  Â  Â  Â  NetworkEvent:FireServer("fire", nil, "Use Item", "Bread")
Â  Â  Â  Â  Â  Â  Â  Â  task.wait(10)
Â  Â  Â  Â  Â  Â  Â  Â  NetworkEvent:FireServer("fire", nil, "Use Item", "Water")
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  end)
end

-- [NEW] Anti-AFK Loop to prevent being kicked for inactivity
task.spawn(function()
Â  Â  local VirtualUser = game:GetService("VirtualUser")
Â  Â  while true do
Â  Â  Â  Â  task.wait(240) -- Every 4 minutes, a safe interval to prevent AFK kick
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- This simulates a brief keyboard press which signals activity to the server.
Â  Â  Â  Â  pcall(function()
			VirtualUser:CaptureController()
			VirtualUser:SendKeyEvent(true, Enum.KeyCode.LeftShift, false, game)
			task.wait(0.1)
			VirtualUser:SendKeyEvent(false, Enum.KeyCode.LeftShift, false, game)
			print("Anti-AFK action performed to prevent disconnection.")
		end)
Â  Â  end
end)


-- Player List Update Connections
Players.PlayerAdded:Connect(updatePlayerList)
Players.PlayerRemoving:Connect(updatePlayerList)
local characterFolder = Workspace:FindFirstChild("Character")
if characterFolder then
Â  Â  characterFolder.ChildAdded:Connect(updatePlayerList)
Â  Â  characterFolder.ChildRemoved:Connect(updatePlayerList)
end
Workspace.ChildAdded:Connect(function(child)
Â  Â  if child.Name == "Character" then
Â  Â  Â  Â  child.ChildAdded:Connect(updatePlayerList)
Â  Â  Â  Â  child.ChildRemoved:Connect(updatePlayerList)
Â  Â  Â  Â  updatePlayerList()
Â  Â  end
end)

-- Initial population
updatePlayerList()

-- Re-establish character parts on respawn
LocalPlayer.CharacterAdded:Connect(function(char)
Â  Â  Character = char
Â  Â  HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
end)

print("Merged Control Panel & Diamond Counter UI Loaded Successfully. [v3.3 Anti-AFK] ğŸ› ï¸ğŸ’")
